language: go
go:
  - 1.11.x
env:
  - GO111MODULE=on
install: true
script:
  - go test -v -mod=vendor ./...
  - CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -ldflags "-X github.com/bitgrip/cattlectl/cmd.Version=${TRAVIS_TAG:-0.0.0-dev} -d -s -w -extldflags \"-static\"" -a -tags netgo -installsuffix netgo -mod=vendor -o build/linux/cattlectl
  - CGO_ENABLED=0 GOOS=darwin GOARCH=amd64 go build -ldflags "-X github.com/bitgrip/cattlectl/cmd.Version=${TRAVIS_TAG:-0.0.0-dev} -s -w" -a -tags netgo -installsuffix netgo -mod=vendor -o build/darwin/cattlectl
deploy:
  provider: releases
  api_key:
    secure: E4xIN4+k3HJTQVjVZ2a2bCpj7HTmRkyhUKGp2V8zVgxaXm040v7VHFG4aBTdYQHDpk60Bm8KApL4pYDB2yJGO93I8cCm67My+qg2sLRmTA3XagfJ9qw6fa2iODptwPBbtc99gQpWbMjzSHPvur8PhKbp1nr7+ZAWXT/73T02tSqddOvP2LPlMeCKQ4/GEVF6NEbO6AW2qn1oR/35tnJD5D1nvxgB2ZWBBXX6G7bBh/7eAmoPhJsaDhTytPQeiVWKPj3LiGq8+aj4IetE5ONLo7SDHCclX5wlw+YT561SX0BIB2cLSM1npMVCTaflGJjxuFRAVVPwbk4oRa67OySPC8+ei7J5l0NpL5Mf1dcNiCKpfrJ6JOz+M55bjbVbiWwGd09l2fIqPiN8YLkCjZmKS+G63Wfmjt4VgKnWgJ+QpGt1hbjYDmq4GlnfMAK61YNsQ+R2Zmlk3dJrM2swVh1Dbr1anARpVk2nn6u8dTHuCacRXFT87zEBb4NWHc4eVMx2PfjRkwSJEE70TMoLVVgT4hnPJEH0PBtcuoxtzw1E2StXjRBK7oXHXKrxzJF5IZQ51lMX+pJW+yrdKavc/MVFe72A3CdIg/LGtqJUPx4KVtzx563M6Qd8N5Js4F0m3wVmp9n1v75ZGrkgvGTM+x/P7wyGcsE7ns7LVe//EJk2s9c=
  file:
    - build/linux/cattlectl
    - build/darwin/cattlectl
  skip_cleanup: true
  on:
    repo: bitgrip/cattlectl
    tags: true
